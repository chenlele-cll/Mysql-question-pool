##  MVCC

MVCC（Multi-Version Concurrency Control）是多版本并发控制。

MVCC 在并发访问数据库时，通过对数据进行多版本控制，避免因写锁而导致的读操作阻塞。

通俗来说，MVCC 是通过对数据进行多版本保存，根据比较版本号来控制数据是否展示，

从而达到读取数据时无需加锁就可以实现事务的隔离性。实现核心是通过 undo log 和一致性视图。



####  undo log

innodb 在修改数据库数据记录之前都会在 undo log 记录回滚日志：

- 执行 insert 时对应在 undo log 中记录一条 delete 语句，并且会记录这个版本的事务 ID
- 执行 update 时会有一条 update 语句使其恢复到上个版本

undo log 主要用于事务回滚和 MVCC 获取不同事务 ID 对应的数据来实现事务隔离



####  一致性视图

InnoDB 为每个事务构造了一个数组，用来保存事务启动瞬间，当前活跃的所有事务 ID。

活跃指的是事务启动了但是还未提交。简而言之，一致性视图就是一个数组，

通过该数据我们可以判断出来事务的执行先后顺序，所能读取到的数据版本。



一个数据版本，对于一个数据视图来说，出来自己的更新总是可见以外，有三种情况：

- 版本未提交、不可见
- 版本已提交、但是是在视图创建后提交的，不可见
- 版本已提交、而且是在视图创建前提交的，可见

