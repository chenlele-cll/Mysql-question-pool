##  查询缓存

查询缓存是用来缓存查询的整个结果集信息，并且共享给所有客户端。

为了提高完全相同语句的查询相应速度，Mysql 会将语句进行哈希计算后，

将哈希值和查询的结果存放的缓存中。当有新的查询来了以后，也会进行哈希计算，

然后通过哈希值再缓存中匹配：

- 若没有匹配：则将该哈希值存放到哈希链中，并将结果集存放到缓存中
- 若成功匹配：则直接将结果返回给客户端



####  缓存失效

在表的结构或数据发生变化时，查询缓存中的数据不再有效。比如：

- INSERT
- UPDATE
- DELETE
- TRUNCATE
- ALTER TABLE
- DROP TABLE
- DROP DATABASE

所以查询缓存适合有大量相同查询的应用，而不适合有大量数据更新的应用



####  手动清理缓存

- FLUSH QUERY CACHE：清理查询缓存中的内存碎片
- RESET QUERTY CACHE：移除查询缓存中的所有查询
- FLUSH TABLES：关闭所有打开的表，同事清空查询缓存中的内容



####  缓存中的内存管理

缓存中采用的是内存池技术，自己管理内存的分配和释放，而不是通过操作系统。

内存池使用的基本单位是变长的块。一个结果集的缓存通过链表将这些块串起来。

块的最短长度为 `query_cache_min_res_unit`